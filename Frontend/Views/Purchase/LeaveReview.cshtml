@model LeaveReviewViewModel
@section Styles {
    <link rel="stylesheet" href="~/css/leave-review.css" asp-append-version="true" />
}
@{
    ViewData["Title"] = "Leave Review";
}

<div class="container leave-review-container">
    <div class="row justify-content-center">
        <div class="col-md-7 col-lg-6">
            <div class="card leave-review-card shadow">
                <!-- Header -->
                <div class="card-header bg-white border-bottom">
                    <h1 class="h4 mb-0 fw-bold">Leave feedback</h1>
                </div>

                <div class="card-body p-4">
                    <!-- Product Info Header -->
                    <div class="product-info-section mb-4">
                        <div class="d-flex align-items-start gap-3">
                            @if (!string.IsNullOrEmpty(Model.ProductImage))
                            {
                                <img src="@Model.ProductImage" alt="@Model.ProductTitle" class="product-thumbnail" />
                            }
                            else
                            {
                                <div class="product-thumbnail-placeholder">
                                    <i class="bi bi-image"></i>
                                </div>
                            }
                            <div class="product-info-text">
                                <p class="text-muted small mb-1">You're reviewing:</p>
                                <h2 class="h6 mb-0 fw-semibold">@Model.ProductTitle</h2>
                            </div>
                        </div>
                    </div>

                    <hr class="my-4" />

                    <!-- Leave Review Form -->
                    <form asp-action="LeaveReview" method="post" id="reviewForm">
                        <input type="hidden" asp-for="ProductId" />
                        <input type="hidden" asp-for="ProductTitle" />
                        <input type="hidden" asp-for="ProductImage" />

                        <!-- Section 1: Star Rating (REQUIRED) -->
                        <div class="mb-4">
                            <label class="form-label fw-semibold d-flex align-items-center gap-2">
                                Rate this item
                                <span class="text-danger">*</span>
                            </label>
                            <span asp-validation-for="Rating" class="text-danger d-block small mb-2"></span>

                            <!-- Star Rating -->
                            <div class="star-rating-container">
                                <div class="star-rating">
                                    <input type="radio" id="star5" name="Rating" value="5" />
                                    <label for="star5" title="5 stars - Excellent">★</label>

                                    <input type="radio" id="star4" name="Rating" value="4" />
                                    <label for="star4" title="4 stars - Good">★</label>

                                    <input type="radio" id="star3" name="Rating" value="3" />
                                    <label for="star3" title="3 stars - Average">★</label>

                                    <input type="radio" id="star2" name="Rating" value="2" />
                                    <label for="star2" title="2 stars - Poor">★</label>

                                    <input type="radio" id="star1" name="Rating" value="1" />
                                    <label for="star1" title="1 star - Terrible">★</label>
                                </div>
                                <span class="star-rating-hint small text-muted ms-3" id="starHint">Select rating</span>
                            </div>
                        </div>

                        <!-- Section 2: Written Comment -->
                        <div class="mb-4">
                            <label asp-for="Comment" class="form-label fw-semibold">
                                Tell us more about your experience <span class="text-muted small">(Optional)</span>
                            </label>
                            <textarea asp-for="Comment"
                                      class="form-control feedback-textarea"
                                      rows="5"
                                      maxlength="500"
                                      id="commentTextarea"
                                      placeholder="Share details about your experience with this item..."></textarea>
                            <div class="d-flex justify-content-between align-items-center mt-1">
                                <span class="form-text small text-muted">Be specific and honest</span>
                                <span class="form-text small text-muted" id="charCount">0 / 500</span>
                            </div>
                        </div>

                        <!-- Section 3: Add Photos Placeholder -->
                        <div class="mb-4">
                            <label class="form-label fw-semibold">
                                Add photos <span class="text-muted small">(Optional)</span>
                            </label>
                            <div class="upload-placeholder-container">
                                <div class="upload-placeholder">
                                    <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" class="upload-icon">
                                        <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                                        <circle cx="8.5" cy="8.5" r="1.5"></circle>
                                        <polyline points="21 15 16 10 5 21"></polyline>
                                    </svg>
                                    <p class="mb-1 fw-semibold">Add up to 5 photos</p>
                                    <p class="small text-muted mb-0">Feature coming soon</p>
                                </div>
                            </div>
                        </div>

                        <!-- Validation Summary -->
                        <div asp-validation-summary="ModelOnly" class="alert alert-danger small" role="alert"></div>

                        <!-- Action Buttons -->
                        <div class="d-grid gap-2">
                            <button type="submit" class="btn btn-primary btn-leave-feedback">
                                Leave feedback
                            </button>
                            <a asp-controller="Purchase" asp-action="Index" class="btn btn-outline-secondary">
                                Cancel
                            </a>
                        </div>

                        <!-- Helper Text -->
                        <p class="small text-muted text-center mt-3 mb-0">
                            Your review will be visible to other shoppers
                        </p>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Character counter for textarea
            const textarea = document.getElementById('commentTextarea');
            const charCount = document.getElementById('charCount');

            if (textarea && charCount) {
                textarea.addEventListener('input', function() {
                    const count = this.value.length;
                    charCount.textContent = `${count} / 500`;
                });
            }

            // Star rating interaction
            const starInputs = document.querySelectorAll('.star-rating input[type="radio"]');
            const starHint = document.getElementById('starHint');
            const starLabels = document.querySelectorAll('.star-rating label');

            // Update hint text when star is selected
            starInputs.forEach(input => {
                input.addEventListener('change', function() {
                    if (starHint) {
                        const ratingText = {
                            '5': 'Excellent',
                            '4': 'Good',
                            '3': 'Average',
                            '2': 'Poor',
                            '1': 'Terrible'
                        };
                        starHint.textContent = ratingText[this.value] || 'Select rating';
                    }
                });
            });

            // Visual feedback on hover
            starLabels.forEach((label, index) => {
                label.addEventListener('mouseenter', function() {
                    // Highlight stars up to hovered star
                    starLabels.forEach((l, i) => {
                        if (i >= starLabels.length - index - 1) {
                            l.style.transform = 'scale(1.1)';
                        }
                    });
                });

                label.addEventListener('mouseleave', function() {
                    // Reset scale
                    starLabels.forEach(l => {
                        l.style.transform = 'scale(1)';
                    });
                });
            });
        });
    </script>
}